groups:
- name: nunchi-slo
  rules:
  # Availability: 99.9% (error budget 0.1%). Fast burn page.
  - alert: AvailabilityBudgetBurnFast
    expr: (
      sum(rate(http_requests_total{status=~"5.."}[5m]))
      / sum(rate(http_requests_total[5m]))
    ) > (0.1/100) * 14.4
    for: 2m
    labels: {severity: page}
    annotations:
      summary: "Fast error-budget burn"
      description: "5m error ratio burning >14.4× 7d budget."

  # Slower burn → ticket.
  - alert: AvailabilityBudgetBurnSlow
    expr: (
      sum(rate(http_requests_total{status=~"5.."}[1h]))
      / sum(rate(http_requests_total[1h]))
    ) > (0.1/100) * 6
    for: 2h
    labels: {severity: ticket}
    annotations:
      summary: "Slow error-budget burn"
      description: "1h error ratio burning >6× 7d budget."

  # Latency SLO: 99% <= 300ms (use p99 threshold for demo noise tolerance).
  - alert: HighLatencyP99
    expr: histogram_quantile(
            0.99, sum by (le)(rate(http_request_duration_seconds_bucket{path="/work"}[5m]))
          ) > 0.3
    for: 15m
    labels: {severity: ticket}
    annotations:
      summary: "p99 latency > 300ms"
      description: "p99 over 300ms for 15m."
